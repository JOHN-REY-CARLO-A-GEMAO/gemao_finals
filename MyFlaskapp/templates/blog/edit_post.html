{% extends "base.html" %}

{% block title %}Edit Blog Post{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header text-white py-3">
                <h3 class="mb-0">Edit Blog Post</h3>
                <small>Modify your existing blog post</small>
            </div>
            <div class="card-body">
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show" role="alert">
                                {{ message }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            </div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}

                <form method="POST" action="{{ url_for('blog.edit_post', post_id=post.id) }}">
                    <div class="row">
                        <div class="col-md-8">
                            <!-- Title Field -->
                            <div class="mb-3">
                                <label for="title" class="form-label">Title <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="title" name="title" required 
                                       value="{{ post.title }}" placeholder="Enter blog post title">
                            </div>

                            <!-- Content Field -->
                            <div class="mb-3">
                                <label for="content" class="form-label">Content <span class="text-danger">*</span></label>
                                <textarea class="form-control" id="content" name="content" rows="15" required 
                                          placeholder="Write your blog post content here...">{{ post.content }}</textarea>
                            </div>

                            <!-- Tags Field -->
                            <div class="mb-3">
                                <label for="tags" class="form-label">Tags</label>
                                <input type="text" class="form-control" id="tags" name="tags" 
                                       value="{{ post.tags or '' }}" placeholder="Enter tags separated by commas (e.g., naruto, tutorial, jutsu)">
                                <small class="text-muted">Separate multiple tags with commas</small>
                            </div>

                            <!-- Category Field -->
                            <div class="mb-3">
                                <label for="category" class="form-label">Category</label>
                                <select class="form-select" id="category" name="category">
                                    <option value="General" {% if post.category == 'General' %}selected{% endif %}>General</option>
                                    <option value="Updates" {% if post.category == 'Updates' %}selected{% endif %}>Updates</option>
                                    <option value="Announcements" {% if post.category == 'Announcements' %}selected{% endif %}>Announcements</option>
                                </select>
                                <small class="text-muted">Select the category for your blog post</small>
                            </div>

                            <!-- Featured Image Field -->
                            <div class="mb-3">
                                <label for="featured_image" class="form-label">Featured Image URL</label>
                                <input type="url" class="form-control" id="featured_image" name="featured_image" 
                                       value="{{ post.featured_image or '' }}" placeholder="https://example.com/image.jpg">
                                <small class="text-muted">Optional: URL to a featured image for the blog post</small>
                            </div>
                        </div>

                        <div class="col-md-4">
                            <!-- Publishing Options -->
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Publishing Options</h5>
                                </div>
                                <div class="card-body">
                                    <!-- Status Field -->
                                    <div class="mb-3">
                                        <label for="status" class="form-label">Status</label>
                                        <select class="form-select" id="status" name="status">
                                            <option value="draft" {% if post.status == 'draft' %}selected{% endif %}>Draft</option>
                                            <option value="published" {% if post.status == 'published' %}selected{% endif %}>Published</option>
                                        </select>
                                        <small class="text-muted">
                                            Draft: Save but don't publish<br>
                                            Published: Publish immediately
                                        </small>
                                    </div>

                                    <!-- Post Info -->
                                    <div class="mb-3">
                                        <small class="text-muted">
                                            <strong>Created:</strong> {{ post.created_at.strftime('%B %d, %Y at %I:%M %p') }}<br>
                                            {% if post.updated_at != post.created_at %}
                                            <strong>Last Updated:</strong> {{ post.updated_at.strftime('%B %d, %Y at %I:%M %p') }}<br>
                                            {% endif %}
                                            <strong>Views:</strong> {{ post.view_count or 0 }}
                                        </small>
                                    </div>

                                    <!-- Submit Buttons -->
                                    <div class="d-grid gap-2">
                                        <button type="submit" class="btn btn-outline-secondary">
                                            <i class="fas fa-save"></i> Save Changes
                                        </button>
                                        <button type="submit" class="btn btn-primary">
                                            <i class="fas fa-paper-plane"></i> Update & Publish
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Quick Actions -->
                            <div class="card mt-3">
                                <div class="card-header">
                                    <h5 class="mb-0">Quick Actions</h5>
                                </div>
                                <div class="card-body">
                                    <div class="d-grid gap-2">
                                        <a href="{{ url_for('blog.view_post', post_id=post.id) }}" class="btn btn-outline-primary">
                                            <i class="fas fa-eye"></i> View Post
                                        </a>
                                        <a href="{{ url_for('blog.index') }}" class="btn btn-outline-secondary">
                                            <i class="fas fa-list"></i> All Posts
                                        </a>
                                    </div>
                                </div>
                            </div>

                            <!-- Delete Action -->
                            <div class="card mt-3">
                                <div class="card-body">
                                    <form method="POST" action="{{ url_for('blog.delete_post', post_id=post.id) }}" 
                                          onsubmit="return confirm('Are you sure you want to delete this post? This action cannot be undone.')">
                                        <button type="submit" class="btn btn-danger w-100">
                                            <i class="fas fa-trash"></i> Delete Post
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Simple character counter for content -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const contentTextarea = document.getElementById('content');
    if (contentTextarea) {
        // Add character counter
        const counter = document.createElement('div');
        counter.className = 'text-muted small mt-1';
        counter.style.textAlign = 'right';
        contentTextarea.parentNode.appendChild(counter);
        
        function updateCounter() {
            counter.textContent = `${contentTextarea.value.length} characters`;
        }
        
        contentTextarea.addEventListener('input', updateCounter);
        updateCounter();
    }
});
</script>
{% endblock %}
